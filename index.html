<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á - ‡∏•‡∏∏‡∏á‡∏î‡∏≥‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2d5016;
            --secondary-color: #6b8e23;
            --accent-color: #8fbc8f;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --light-bg: #f8f9fa;
            --dark-text: #212529;
            --border-color: #dee2e6;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark-text);
            padding-bottom: 100px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .date-picker-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark-text);
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(45, 80, 22, 0.1);
        }

        .info-badge {
            background: var(--accent-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
            margin: 5px 5px 5px 0;
        }

        .room-card {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .room-card.selected {
            border-color: var(--primary-color);
            background: rgba(45, 80, 22, 0.05);
        }

        .room-card.unavailable {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f8f9fa;
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .room-name {
            font-weight: bold;
            font-size: 16px;
            color: var(--primary-color);
        }

        .room-status {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }

        .room-status.available {
            background: #d4edda;
            color: #155724;
        }

        .room-status.unavailable {
            background: #f8d7da;
            color: #721c24;
        }

        .room-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .room-pricing {
            background: var(--light-bg);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 13px;
        }

        .room-pricing-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .guest-selector {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--light-bg);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .guest-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn-guest {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .btn-guest:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }

        .btn-guest:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: scale(1);
        }

        .guest-count {
            font-size: 18px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }

        .food-item {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .food-item.selected {
            border-color: var(--primary-color);
            background: rgba(45, 80, 22, 0.05);
        }

        .food-info {
            flex: 1;
        }

        .food-name {
            font-weight: bold;
            font-size: 16px;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .food-price {
            color: var(--secondary-color);
            font-weight: 600;
        }

        .food-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-section {
            background: var(--light-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .summary-row.total {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            padding-top: 10px;
            border-top: 2px solid var(--border-color);
        }

        .summary-row.deposit {
            font-size: 16px;
            font-weight: bold;
            color: var(--danger-color);
        }

        .qr-container {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .qr-image {
            max-width: 250px;
            height: auto;
            margin: 15px auto;
            border: 3px solid var(--border-color);
            border-radius: 8px;
        }

        .payment-info {
            background: var(--light-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .payment-info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--light-bg);
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background: rgba(45, 80, 22, 0.05);
        }

        .upload-area.has-file {
            border-color: var(--success-color);
            background: rgba(40, 167, 69, 0.05);
        }

        .upload-preview {
            max-width: 200px;
            margin: 15px auto;
            border-radius: 8px;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }

        .checkbox-group label {
            flex: 1;
            cursor: pointer;
            font-size: 14px;
            line-height: 1.5;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(45, 80, 22, 0.3);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 99;
        }

        .bottom-bar-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark-text);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .toast.show {
            display: block;
        }

        .toast.success {
            background: var(--success-color);
        }

        .toast.error {
            background: var(--danger-color);
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        .discount-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .discount-input-group input {
            flex: 1;
        }

        .discount-input-group button {
            padding: 12px 20px;
            background: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }

        .discount-input-group button:hover {
            background: var(--primary-color);
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 20px;
            }
            
            .date-picker-group {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèïÔ∏è ‡∏•‡∏∏‡∏á‡∏î‡∏≥‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á</h1>
        <p>‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á‡∏™‡∏∏‡∏î‡∏´‡∏£‡∏π</p>
    </div>

    <div class="toast" id="toast"></div>

    <div class="container">
        <!-- ‡∏´‡∏ô‡πâ‡∏≤ 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡πâ‡∏≠‡∏á -->
        <div id="page1" class="page">
            <div class="card">
                <div class="card-title">üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</div>
                <div class="date-picker-group">
                    <div class="form-group">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô</label>
                        <input type="date" id="checkInDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå</label>
                        <input type="date" id="checkOutDate" class="form-control">
                    </div>
                </div>
                <div id="nightsInfo"></div>
            </div>

            <div class="card">
                <div class="card-title">üè† ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</div>
                <div id="roomsList"></div>
            </div>

            <div class="card hidden" id="summaryCard1">
                <div class="card-title">üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</div>
                <div class="summary-section">
                    <div class="summary-row">
                        <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏∑‡∏ô:</span>
                        <span id="summaryNights1">-</span>
                    </div>
                    <div class="summary-row">
                        <span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏°:</span>
                        <span id="summaryRoomTotal1">-</span>
                    </div>
                    <div class="summary-row deposit">
                        <span>‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥:</span>
                        <span id="summaryDeposit1">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤ 2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£ -->
        <div id="page2" class="page hidden">
            <div class="card">
                <div class="card-title">üçΩÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</div>
                <div id="foodsList"></div>
            </div>

            <div class="card">
                <div class="card-title">üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</div>
                <div class="summary-section">
                    <div class="summary-row">
                        <span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏ß‡∏°:</span>
                        <span id="summaryRoomTotal2">-</span>
                    </div>
                    <div class="summary-row">
                        <span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏£‡∏ß‡∏°:</span>
                        <span id="summaryFoodTotal2">-</span>
                    </div>
                    <div class="summary-row deposit">
                        <span>‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥:</span>
                        <span id="summaryDeposit2">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‡∏´‡∏ô‡πâ‡∏≤ 3: ‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
        <div id="page3" class="page hidden">
            <div class="card">
                <div class="card-title">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</div>
                <div id="bookingSummary"></div>
            </div>

            <div class="card">
                <div class="card-title">üí≥ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥</div>
                <div class="qr-container">
                    <h3>‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
                    <img id="qrCode" class="qr-image" alt="QR Code">
                    <div class="payment-info">
                        <div class="payment-info-row">
                            <span>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ:</span>
                            <strong>‡∏≠‡∏•‡∏á‡∏Å‡∏ï ‡∏ó‡∏ß‡∏µ‡∏ú‡πà‡∏≠‡∏á</strong>
                        </div>
                        <div class="payment-info-row">
                            <span>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span>
                            <strong>061-592-4262</strong>
                        </div>
                        <div class="payment-info-row">
                            <span>‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥:</span>
                            <strong id="depositAmount" style="color: var(--danger-color); font-size: 18px;">-</strong>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</div>
                <div class="form-group">
                    <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                    <input type="text" id="customerName" class="form-control" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                </div>
                <div class="form-group">
                    <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
                    <input type="tel" id="customerPhone" class="form-control" placeholder="0xx-xxx-xxxx">
                </div>
            </div>

            <div class="card">
                <div class="card-title">üì∏ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô *</div>
                <input type="file" id="slipFile" accept="image/*" style="display: none;">
                <div class="upload-area" id="uploadArea">
                    <div id="uploadPlaceholder">
                        <div style="font-size: 48px; margin-bottom: 10px;">üì§</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ</div>
                        <div style="font-size: 12px; color: #666;">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</div>
                    </div>
                    <div id="uploadPreview" class="hidden">
                        <img id="previewImage" class="upload-preview" alt="Preview">
                        <div id="fileName" style="margin-top: 10px; font-weight: bold;"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="checkbox-group">
                    <input type="checkbox" id="acceptTerms">
                    <label for="acceptTerms">
                        ‡∏Ç‡πâ‡∏≤‡∏û‡πÄ‡∏à‡πâ‡∏≤‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ‡πÇ‡∏î‡∏¢‡∏ó‡∏£‡∏≤‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏à‡∏∞‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô 
                        ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
                    </label>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-bar">
        <div class="bottom-bar-content">
            <div id="navButtons1" class="nav-buttons">
                <button class="btn btn-primary" id="btnNext1" disabled>
                    ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‚Üí
                </button>
            </div>
            <div id="navButtons2" class="nav-buttons hidden">
                <div class="btn-group">
                    <button class="btn btn-secondary" id="btnBack2">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                    <button class="btn btn-primary" id="btnNext2">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: ‡∏™‡∏£‡∏∏‡∏õ ‚Üí</button>
                </div>
            </div>
            <div id="navButtons3" class="nav-buttons hidden">
                <div class="btn-group">
                    <button class="btn btn-secondary" id="btnBack3">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                    <button class="btn btn-primary" id="btnSubmit" disabled>‚úì ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
                </div>
            </div>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p style="margin-top: 15px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            LIFF_ID: 'YOUR_LIFF_ID', // ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
            GAS_URL: 'YOUR_GOOGLE_APPS_SCRIPT_URL', // ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script
            PROMPTPAY_ID: '0615924262',
            TIMEZONE: 'Asia/Bangkok'
        };

        // Global State
        let state = {
            liffProfile: null,
            checkInDate: null,
            checkOutDate: null,
            nights: 0,
            selectedRooms: [],
            selectedFoods: [],
            roomsData: [],
            foodsData: [],
            settings: {},
            discount: null,
            currentPage: 1
        };

        // Room Types Data
        const ROOM_TYPES = [
            {
                id: 'homestay',
                name: '‡πÇ‡∏Æ‡∏°‡∏™‡πÄ‡∏ï‡∏¢‡πå‡∏´‡∏ô‡∏≥‡πÇ‡∏õ',
                type: 'homestay',
                pricing: [
                    { min: 4, max: 5, price: 1600 },
                    { min: 6, max: 8, price: 2200 }
                ],
                maxGuests: 8
            },
            {
                id: 'riverside1',
                name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏£‡∏¥‡∏°‡∏ô‡πâ‡∏≥ 1',
                type: 'riverside',
                pricing: [
                    { min: 1, max: 2, price: 1400 },
                    { min: 3, max: 3, price: 1750 }
                ],
                maxGuests: 3
            },
            {
                id: 'riverside2',
                name: '‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏£‡∏¥‡∏°‡∏ô‡πâ‡∏≥ 2',
                type: 'riverside',
                pricing: [
                    { min: 1, max: 2, price: 1400 },
                    { min: 3, max: 3, price: 1750 }
                ],
                maxGuests: 3
            },
            {
                id: 'tent1',
                name: '‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏Å‡∏£‡∏∞‡πÇ‡∏à‡∏° 1',
                type: 'tent',
                pricing: [
                    { min: 1, max: 2, price: 1200 },
                    { min: 3, max: 4, price: 1550 }
                ],
                maxGuests: 4
            },
            {
                id: 'tent2',
                name: '‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏Å‡∏£‡∏∞‡πÇ‡∏à‡∏° 2',
                type: 'tent',
                pricing: [
                    { min: 1, max: 2, price: 1200 },
                    { min: 3, max: 4, price: 1550 }
                ],
                maxGuests: 4
            },
            {
                id: 'fieldtent_k1',
                name: '‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏™‡∏ô‡∏≤‡∏° K1',
                type: 'field_tent',
                pricing: [
                    { min: 1, max: 2, price: 700 }
                ],
                maxGuests: 2
            },
            {
                id: 'fieldtent_k2',
                name: '‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏™‡∏ô‡∏≤‡∏° K2',
                type: 'field_tent',
                pricing: [
                    { min: 1, max: 2, price: 700 }
                ],
                maxGuests: 2
            },
            {
                id: 'camping_area',
                name: '‡∏•‡∏≤‡∏ô‡∏Å‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå',
                type: 'camping_area',
                pricing: [
                    { min: 1, max: 20, price: 150, perPerson: true }
                ],
                maxGuests: 20,
                allowMultiple: true
            }
        ];

        // Food Menu Data
        const FOOD_MENU = [
            { id: 'pork_pan', name: '‡∏ä‡∏∏‡∏î‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'chicken_pan', name: '‡∏ä‡∏∏‡∏î‡πÑ‡∏Å‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏∞‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'pork_shabu', name: '‡∏ä‡∏∏‡∏î‡∏ä‡∏≤‡∏ö‡∏π‡∏´‡∏°‡∏π‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'chicken_shabu', name: '‡∏ä‡∏∏‡∏î‡∏ä‡∏≤‡∏ö‡∏π‡πÑ‡∏Å‡πà‡∏•‡∏∏‡∏á‡∏î‡∏≥', price: 390 },
            { id: 'local_food', name: '‡πÄ‡∏ã‡πá‡∏ï‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô', price: 390 }
        ];

        // Initialize LIFF
        async function initializeLiff() {
            try {
                await liff.init({ liffId: CONFIG.LIFF_ID });
                
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return false;
                }

                state.liffProfile = await liff.getProfile();
                return true;
            } catch (error) {
                console.error('LIFF initialization failed:', error);
                showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE ‡πÑ‡∏î‡πâ', 'error');
                return false;
            }
        }

        // Initialize App
        async function initializeApp() {
            showLoading(true);

            // Initialize LIFF
            const liffReady = await initializeLiff();
            if (!liffReady) {
                showLoading(false);
                return;
            }

            // Set default dates
            setDefaultDates();

            // Load settings and data
            await loadSettings();
            await checkRoomAvailability();

            // Render rooms and foods
            renderRooms();
            renderFoods();

            // Setup event listeners
            setupEventListeners();

            showLoading(false);
        }

        // Set default dates (tomorrow and day after)
        function setDefaultDates() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);

            const dayAfter = new Date(tomorrow);
            dayAfter.setDate(dayAfter.getDate() + 1);

            const checkInInput = document.getElementById('checkInDate');
            const checkOutInput = document.getElementById('checkOutDate');

            checkInInput.value = formatDateForInput(tomorrow);
            checkOutInput.value = formatDateForInput(dayAfter);

            // Set min date (tomorrow)
            checkInInput.min = formatDateForInput(tomorrow);
            checkOutInput.min = formatDateForInput(dayAfter);

            state.checkInDate = tomorrow;
            state.checkOutDate = dayAfter;
            state.nights = calculateNights(tomorrow, dayAfter);

            updateNightsDisplay();
        }

        // Format date for input (YYYY-MM-DD)
        function formatDateForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Format date for display (DD/MM/YYYY in Buddhist Era)
        function formatDateForDisplay(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear() + 543; // Buddhist Era
            return `${day}/${month}/${year}`;
        }

        // Calculate nights
        function calculateNights(checkIn, checkOut) {
            const diffTime = checkOut - checkIn;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Update nights display
        function updateNightsDisplay() {
            const nightsInfo = document.getElementById('nightsInfo');
            if (state.nights > 0) {
                nightsInfo.innerHTML = `<div class="info-badge">üìÖ ${state.nights} ‡∏Ñ‡∏∑‡∏ô</div>`;
            } else {
                nightsInfo.innerHTML = '';
            }
        }

        // Load settings from backend
        async function loadSettings() {
            try {
                const response = await fetch(`${CONFIG.GAS_URL}?action=getSettings`);
                const data = await response.json();
                state.settings = data.settings || { depositPercent: 50 };
            } catch (error) {
                console.error('Failed to load settings:', error);
                state.settings = { depositPercent: 50 };
            }
        }

        // Check room availability
        async function checkRoomAvailability() {
            if (!state.checkInDate || !state.checkOutDate) return;

            try {
                const response = await fetch(`${CONFIG.GAS_URL}?action=checkAvailability`, {
                    method: 'POST',
                    body: JSON.stringify({
                        checkIn: formatDateForInput(state.checkInDate),
                        checkOut: formatDateForInput(state.checkOutDate)
                    })
                });

                const data = await response.json();
                state.roomsData = data.rooms || [];
                renderRooms();
            } catch (error) {
                console.error('Failed to check availability:', error);
                showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ', 'error');
            }
        }

        // Render rooms
        function renderRooms() {
            const roomsList = document.getElementById('roomsList');
            roomsList.innerHTML = '';

            ROOM_TYPES.forEach(room => {
                const availability = state.roomsData.find(r => r.id === room.id);
                const isAvailable = !availability || availability.available;
                const bookedGuests = availability ? availability.bookedGuests : 0;

                const roomCard = document.createElement('div');
                roomCard.className = `room-card ${!isAvailable ? 'unavailable' : ''}`;
                roomCard.dataset.roomId = room.id;

                let pricingHtml = '';
                room.pricing.forEach(p => {
                    const priceText = p.perPerson ? `${p.price} ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏ô/‡∏Ñ‡∏∑‡∏ô` : `${p.price} ‡∏ö‡∏≤‡∏ó/‡∏Ñ‡∏∑‡∏ô`;
                    const guestText = p.perPerson ? '' : ` (${p.min}${p.max !== p.min ? `-${p.max}` : ''} ‡∏Ñ‡∏ô)`;
                    pricingHtml += `<div class="room-pricing-item"><span>${guestText}</span><span>${priceText}</span></div>`;
                });

                const availabilityText = room.type === 'camping_area' 
                    ? `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á: ${room.maxGuests - bookedGuests} ‡∏Ñ‡∏ô`
                    : (isAvailable ? '‡∏ß‡πà‡∏≤‡∏á' : '‡πÄ‡∏ï‡πá‡∏°');

                roomCard.innerHTML = `
                    <div class="room-header">
                        <div class="room-name">${room.name}</div>
                        <div class="room-status ${isAvailable ? 'available' : 'unavailable'}">${availabilityText}</div>
                    </div>
                    <div class="room-info">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: ${room.maxGuests} ‡∏Ñ‡∏ô</div>
                    <div class="room-pricing">${pricingHtml}</div>
                    ${isAvailable ? `
                        <div class="guest-selector">
                            <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô:</span>
                            <div class="guest-controls">
                                <button class="btn-guest" data-action="decrease">-</button>
                                <span class="guest-count">0</span>
                                <button class="btn-guest" data-action="increase">+</button>
                            </div>
                        </div>
                    ` : ''}
                `;

                if (isAvailable) {
                    roomCard.addEventListener('click', (e) => {
                        if (e.target.classList.contains('btn-guest')) {
                            e.stopPropagation();
                            handleGuestChange(room.id, e.target.dataset.action);
                        }
                    });
                }

                roomsList.appendChild(roomCard);
            });
        }

        // Handle guest count change
        function handleGuestChange(roomId, action) {
            const room = ROOM_TYPES.find(r => r.id === roomId);
            const roomCard = document.querySelector(`[data-room-id="${roomId}"]`);
            const guestCountEl = roomCard.querySelector('.guest-count');
            let currentCount = parseInt(guestCountEl.textContent);

            if (action === 'increase' && currentCount < room.maxGuests) {
                currentCount++;
            } else if (action === 'decrease' && currentCount > 0) {
                currentCount--;
            }

            guestCountEl.textContent = currentCount;

            // Update selected rooms
            const existingIndex = state.selectedRooms.findIndex(r => r.id === roomId);
            if (currentCount > 0) {
                const price = calculateRoomPrice(room, currentCount);
                if (existingIndex >= 0) {
                    state.selectedRooms[existingIndex].guests = currentCount;
                    state.selectedRooms[existingIndex].price = price;
                } else {
                    state.selectedRooms.push({
                        id: roomId,
                        name: room.name,
                        guests: currentCount,
                        price: price
                    });
                }
                roomCard.classList.add('selected');
            } else {
                if (existingIndex >= 0) {
                    state.selectedRooms.splice(existingIndex, 1);
                }
                roomCard.classList.remove('selected');
            }

            updateSummary();
            updateNavButtons();
        }

        // Calculate room price
        function calculateRoomPrice(room, guests) {
            const pricing = room.pricing.find(p => guests >= p.min && guests <= p.max);
            if (!pricing) return 0;

            if (pricing.perPerson) {
                return pricing.price * guests * state.nights;
            } else {
                return pricing.price * state.nights;
            }
        }

        // Render foods
        function renderFoods() {
            const foodsList = document.getElementById('foodsList');
            foodsList.innerHTML = '';

            FOOD_MENU.forEach(food => {
                const foodItem = document.createElement('div');
                foodItem.className = 'food-item';
                foodItem.dataset.foodId = food.id;

                foodItem.innerHTML = `
                    <div class="food-info">
                        <div class="food-name">${food.name}</div>
                        <div class="food-price">${food.price} ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏∏‡∏î</div>
                    </div>
                    <div class="food-controls">
                        <button class="btn-guest" data-action="decrease">-</button>
                        <span class="guest-count">0</span>
                        <button class="btn-guest" data-action="increase">+</button>
                    </div>
                `;

                foodItem.addEventListener('click', (e) => {
                    if (e.target.classList.contains('btn-guest')) {
                        e.stopPropagation();
                        handleFoodChange(food.id, e.target.dataset.action);
                    }
                });

                foodsList.appendChild(foodItem);
            });
        }

        // Handle food quantity change
        function handleFoodChange(foodId, action) {
            const food = FOOD_MENU.find(f => f.id === foodId);
            const foodItem = document.querySelector(`[data-food-id="${foodId}"]`);
            const quantityEl = foodItem.querySelector('.guest-count');
            let currentQty = parseInt(quantityEl.textContent);

            if (action === 'increase') {
                currentQty++;
            } else if (action === 'decrease' && currentQty > 0) {
                currentQty--;
            }

            quantityEl.textContent = currentQty;

            // Update selected foods
            const existingIndex = state.selectedFoods.findIndex(f => f.id === foodId);
            if (currentQty > 0) {
                if (existingIndex >= 0) {
                    state.selectedFoods[existingIndex].quantity = currentQty;
                } else {
                    state.selectedFoods.push({
                        id: foodId,
                        name: food.name,
                        price: food.price,
                        quantity: currentQty
                    });
                }
                foodItem.classList.add('selected');
            } else {
                if (existingIndex >= 0) {
                    state.selectedFoods.splice(existingIndex, 1);
                }
                foodItem.classList.remove('selected');
            }

            updateSummary();
        }

        // Update summary
        function updateSummary() {
            const roomTotal = state.selectedRooms.reduce((sum, room) => sum + room.price, 0);
            const foodTotal = state.selectedFoods.reduce((sum, food) => sum + (food.price * food.quantity), 0);
            const discount = state.discount ? calculateDiscount(roomTotal) : 0;
            const deposit = calculateDeposit(roomTotal - discount, foodTotal);

            // Page 1 summary
            document.getElementById('summaryNights1').textContent = `${state.nights} ‡∏Ñ‡∏∑‡∏ô`;
            document.getElementById('summaryRoomTotal1').textContent = `${roomTotal.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('summaryDeposit1').textContent = `${deposit.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;

            // Page 2 summary
            document.getElementById('summaryRoomTotal2').textContent = `${roomTotal.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('summaryFoodTotal2').textContent = `${foodTotal.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('summaryDeposit2').textContent = `${deposit.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;

            // Show/hide summary card
            const summaryCard = document.getElementById('summaryCard1');
            if (state.selectedRooms.length > 0) {
                summaryCard.classList.remove('hidden');
            } else {
                summaryCard.classList.add('hidden');
            }
        }

        // Calculate discount
        function calculateDiscount(roomTotal) {
            if (!state.discount) return 0;

            if (state.discount.type === 'amount') {
                return Math.min(state.discount.value, roomTotal);
            } else {
                return Math.floor(roomTotal * state.discount.value / 100);
            }
        }

        // Calculate deposit
        function calculateDeposit(roomTotal, foodTotal) {
            const depositPercent = state.settings.depositPercent || 50;
            const roomDeposit = Math.ceil(roomTotal * depositPercent / 100);
            return roomDeposit + foodTotal;
        }

        // Update navigation buttons
        function updateNavButtons() {
            const btnNext1 = document.getElementById('btnNext1');
            btnNext1.disabled = state.selectedRooms.length === 0;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Date change
            document.getElementById('checkInDate').addEventListener('change', handleDateChange);
            document.getElementById('checkOutDate').addEventListener('change', handleDateChange);

            // Navigation buttons
            document.getElementById('btnNext1').addEventListener('click', () => goToPage(2));
            document.getElementById('btnBack2').addEventListener('click', () => goToPage(1));
            document.getElementById('btnNext2').addEventListener('click', () => goToPage(3));
            document.getElementById('btnBack3').addEventListener('click', () => goToPage(2));
            document.getElementById('btnSubmit').addEventListener('click', handleSubmit);

            // Upload slip
            document.getElementById('uploadArea').addEventListener('click', () => {
                document.getElementById('slipFile').click();
            });
            document.getElementById('slipFile').addEventListener('change', handleFileUpload);

            // Accept terms
            document.getElementById('acceptTerms').addEventListener('change', updateSubmitButton);
        }

        // Handle date change
        async function handleDateChange() {
            const checkInInput = document.getElementById('checkInDate');
            const checkOutInput = document.getElementById('checkOutDate');

            const checkIn = new Date(checkInInput.value + 'T00:00:00');
            const checkOut = new Date(checkOutInput.value + 'T00:00:00');

            if (checkOut <= checkIn) {
                showToast('‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô', 'error');
                return;
            }

            state.checkInDate = checkIn;
            state.checkOutDate = checkOut;
            state.nights = calculateNights(checkIn, checkOut);

            updateNightsDisplay();
            
            // Reset selections
            state.selectedRooms = [];
            state.selectedFoods = [];
            
            // Reload availability
            showLoading(true);
            await checkRoomAvailability();
            showLoading(false);
            
            updateSummary();
            updateNavButtons();
        }

        // Go to page
        function goToPage(pageNum) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.nav-buttons').forEach(n => n.classList.add('hidden'));

            // Show target page
            document.getElementById(`page${pageNum}`).classList.remove('hidden');
            document.getElementById(`navButtons${pageNum}`).classList.remove('hidden');

            state.currentPage = pageNum;

            // Special handling for page 3
            if (pageNum === 3) {
                renderBookingSummary();
                generateQRCode();
                prefillCustomerInfo();
            }

            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Render booking summary
        function renderBookingSummary() {
            const roomTotal = state.selectedRooms.reduce((sum, room) => sum + room.price, 0);
            const foodTotal = state.selectedFoods.reduce((sum, food) => sum + (food.price * food.quantity), 0);
            const discount = state.discount ? calculateDiscount(roomTotal) : 0;
            const deposit = calculateDeposit(roomTotal - discount, foodTotal);
            const remaining = (roomTotal - discount + foodTotal) - deposit;

            let roomsHtml = '';
            state.selectedRooms.forEach(room => {
                roomsHtml += `
                    <div class="summary-row">
                        <span>${room.name} (${room.guests} ‡∏Ñ‡∏ô)</span>
                        <span>${room.price.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                `;
            });

            let foodsHtml = '';
            state.selectedFoods.forEach(food => {
                foodsHtml += `
                    <div class="summary-row">
                        <span>${food.name} x${food.quantity}</span>
                        <span>${(food.price * food.quantity).toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                `;
            });

            const summaryHtml = `
                <div class="summary-section">
                    <div class="summary-row" style="font-weight: bold; margin-bottom: 10px;">
                        <span>‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å:</span>
                        <span>${formatDateForDisplay(state.checkInDate)}</span>
                    </div>
                    <div class="summary-row" style="font-weight: bold; margin-bottom: 10px;">
                        <span>‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å:</span>
                        <span>${formatDateForDisplay(state.checkOutDate)}</span>
                    </div>
                    <div class="summary-row" style="font-weight: bold; margin-bottom: 15px;">
                        <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏∑‡∏ô:</span>
                        <span>${state.nights} ‡∏Ñ‡∏∑‡∏ô</span>
                    </div>

                    <div style="font-weight: bold; margin: 15px 0 10px 0; color: var(--primary-color);">üè† ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</div>
                    ${roomsHtml}

                    ${foodsHtml ? `
                        <div style="font-weight: bold; margin: 15px 0 10px 0; color: var(--primary-color);">üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>
                        ${foodsHtml}
                    ` : ''}

                    <div style="border-top: 2px solid var(--border-color); margin: 15px 0; padding-top: 15px;">
                        <div class="summary-row">
                            <span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                            <span>${roomTotal.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        ${discount > 0 ? `
                            <div class="summary-row" style="color: var(--success-color);">
                                <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î:</span>
                                <span>-${discount.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                        ` : ''}
                        ${foodTotal > 0 ? `
                            <div class="summary-row">
                                <span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                                <span>${foodTotal.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                            </div>
                        ` : ''}
                        <div class="summary-row total">
                            <span>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                            <span>${(roomTotal - discount + foodTotal).toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="summary-row deposit">
                            <span>‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥ (${state.settings.depositPercent}%):</span>
                            <span>${deposit.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="summary-row">
                            <span>‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</span>
                            <span>${remaining.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('bookingSummary').innerHTML = summaryHtml;
            document.getElementById('depositAmount').textContent = `${deposit.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
        }

        // Generate QR Code
        function generateQRCode() {
            const roomTotal = state.selectedRooms.reduce((sum, room) => sum + room.price, 0);
            const foodTotal = state.selectedFoods.reduce((sum, food) => sum + (food.price * food.quantity), 0);
            const discount = state.discount ? calculateDiscount(roomTotal) : 0;
            const deposit = calculateDeposit(roomTotal - discount, foodTotal);

            // Generate PromptPay QR Code using API
            const qrUrl = `https://promptpay.io/${CONFIG.PROMPTPAY_ID}/${deposit}.png`;
            document.getElementById('qrCode').src = qrUrl;
        }

        // Prefill customer info from LINE profile
        function prefillCustomerInfo() {
            if (state.liffProfile) {
                document.getElementById('customerName').value = state.liffProfile.displayName || '';
            }
        }

        // Handle file upload
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const uploadArea = document.getElementById('uploadArea');
            const uploadPlaceholder = document.getElementById('uploadPlaceholder');
            const uploadPreview = document.getElementById('uploadPreview');
            const previewImage = document.getElementById('previewImage');
            const fileName = document.getElementById('fileName');

            // Show preview
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                fileName.textContent = file.name;
                uploadPlaceholder.classList.add('hidden');
                uploadPreview.classList.remove('hidden');
                uploadArea.classList.add('has-file');
                updateSubmitButton();
            };
            reader.readAsDataURL(file);
        }

        // Update submit button
        function updateSubmitButton() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const slip = document.getElementById('slipFile').files[0];
            const terms = document.getElementById('acceptTerms').checked;

            const btnSubmit = document.getElementById('btnSubmit');
            btnSubmit.disabled = !(name && phone && slip && terms);
        }

        // Handle submit
        async function handleSubmit() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const slip = document.getElementById('slipFile').files[0];

            if (!name || !phone || !slip) {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }

            showLoading(true);

            try {
                // Convert slip to base64
                const slipBase64 = await fileToBase64(slip);

                // Prepare booking data
                const roomTotal = state.selectedRooms.reduce((sum, room) => sum + room.price, 0);
                const foodTotal = state.selectedFoods.reduce((sum, food) => sum + (food.price * food.quantity), 0);
                const discount = state.discount ? calculateDiscount(roomTotal) : 0;
                const deposit = calculateDeposit(roomTotal - discount, foodTotal);

                const bookingData = {
                    action: 'createBooking',
                    checkIn: formatDateForInput(state.checkInDate),
                    checkOut: formatDateForInput(state.checkOutDate),
                    nights: state.nights,
                    rooms: state.selectedRooms,
                    foods: state.selectedFoods,
                    roomTotal: roomTotal,
                    foodTotal: foodTotal,
                    discount: discount,
                    discountCode: state.discount ? state.discount.code : null,
                    deposit: deposit,
                    total: roomTotal - discount + foodTotal,
                    customerName: name,
                    customerPhone: phone,
                    lineUserId: state.liffProfile ? state.liffProfile.userId : null,
                    lineDisplayName: state.liffProfile ? state.liffProfile.displayName : null,
                    linePictureUrl: state.liffProfile ? state.liffProfile.pictureUrl : null,
                    slipFile: slipBase64,
                    slipFileName: slip.name
                };

                // Send to backend
                const response = await fetch(CONFIG.GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify(bookingData)
                });

                const result = await response.json();

                if (result.success) {
                    showToast('‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô', 'success');
                    
                    // Close LIFF after 2 seconds
                    setTimeout(() => {
                        if (liff.isInClient()) {
                            liff.closeWindow();
                        } else {
                            window.location.reload();
                        }
                    }, 2000);
                } else {
                    showToast(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
                }
            } catch (error) {
                console.error('Booking failed:', error);
                showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
            } finally {
                showLoading(false);
            }
        }

        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Show toast
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Show/hide loading
        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        // Initialize on load
        window.addEventListener('load', initializeApp);

        // Listen for customer info changes
        document.getElementById('customerName').addEventListener('input', updateSubmitButton);
        document.getElementById('customerPhone').addEventListener('input', updateSubmitButton);
    </script>
</body>
</html>
